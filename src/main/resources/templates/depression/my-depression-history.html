<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>나의 우울증 검사 결과</title>
</head>
<body>
<div class="header">
    <!-- 헤더 내용을 여기에 포함 -->
</div>
<main>
    <section class="my-page">
        <h1>나의 우울증 검사 결과</h1>
        <div class="results-container">
            <!-- 검사 결과 목록이 여기에 동적으로 추가 -->
        </div>
        <div class="navigation-buttons">
            <button class="prev-button" disabled>&lt;</button>
            <button class="next-button">&gt;</button>
        </div>
        <div class="detail-container" style="display: none;">
            <!-- 검사 결과 상세 정보가 여기에 동적으로 추가 -->
        </div>
    </section>
</main>
<footer>
    <!-- 푸터 내용을 여기에 포함 -->
</footer>

<script th:inline="javascript">

    const testResults = [
        { date: '2023-07-20', score: 8, level: '우울함', message: '검사 결과 메시지1' },
        { date: '2023-07-15', score: 4, level: '정상적임', message: '검사 결과 메시지2' },
        //데이터베이스 가지고오는거 까지됨 근데 이부분을 JSON 타입으로 가지고올 필요가있음
    ];

    // 보여줄 결과 개수와 현재 페이지 인덱스
    // 보여줄 결과 개수와 현재 페이지 인덱스
    const resultsPerPage = 5;
    let currentPageIndex = 0;

    // 검사 결과 목록을 동적으로 페이지에 추가하는 함수
    function showTestResultsList() {
        const resultsContainer = document.querySelector('.results-container');
        resultsContainer.innerHTML = ''; // 기존 목록 초기화

        const startIdx = currentPageIndex * resultsPerPage;
        const endIdx = Math.min(startIdx + resultsPerPage, testResults.length);

        for (let i = startIdx; i < endIdx; i++) {
            const result = testResults[i];
            const resultItem = document.createElement('div');
            resultItem.classList.add('result-item');

            resultItem.innerHTML = `
            <p><b>${result.date}</b></p>
            <p><b id="score">${result.score}</b>점</p>
            <p class="by_score3">${result.level}</p>
            <a href="#" class="details-link" data-index="${i}">상세 보기</a>
        `;

            resultsContainer.appendChild(resultItem);
        }

        const prevButton = document.querySelector('.prev-button');
        const nextButton = document.querySelector('.next-button');

        prevButton.disabled = currentPageIndex === 0;
        nextButton.disabled = endIdx >= testResults.length;

        addDetailsLinkEventListeners(); // 상세 보기 링크에 이벤트 리스너 추가
    }

    // 검사 결과 상세 정보를 동적으로 페이지에 추가하는 함수
    function showTestResultDetails(index) {
        const detailContainer = document.querySelector('.detail-container');
        const result = testResults[index];

        detailContainer.innerHTML = `
        <h2>${result.date} 검사 결과 상세 정보</h2>
        <p><b id="score">${result.score}</b>점</p>
        <p class="by_score3">${result.level}</p>
        <p id="result_message">${result.message}</p>
        <a href="#" class="go-back-link">돌아가기</a>
    `;

        detailContainer.style.display = 'block';

        // 돌아가기 링크에 이벤트 리스너 추가
        document.querySelector('.go-back-link').addEventListener('click', function (event) {
            event.preventDefault();
            detailContainer.style.display = 'none';
        });
    }

    // 상세 보기 링크에 이벤트 리스너 추가하는 함수
    function addDetailsLinkEventListeners() {
        const detailsLinks = document.querySelectorAll('.details-link');
        detailsLinks.forEach(link => {
            link.addEventListener('click', function (event) {
                event.preventDefault();
                const index = link.getAttribute('data-index');
                showTestResultDetails(index);
            });
        });
    }

    // 페이지 로드 시 검사 결과 목록 보여주는 함수 호출
    window.addEventListener('load', function () {
        showTestResultsList();
    });

    // 이전 버튼 클릭 시 이전 페이지로 이동
    document.querySelector('.prev-button').addEventListener('click', function () {
        if (currentPageIndex > 0) {
            currentPageIndex--;
            showTestResultsList();
        }
    });

    // 다음 버튼 클릭 시 다음 페이지로 이동
    document.querySelector('.next-button').addEventListener('click', function () {
        const startIdx = currentPageIndex * resultsPerPage;
        const endIdx = Math.min(startIdx + resultsPerPage, testResults.length);

        if (endIdx < testResults.length) {
            currentPageIndex++;
            showTestResultsList();
        }
    });

</script>
</body>
</html>